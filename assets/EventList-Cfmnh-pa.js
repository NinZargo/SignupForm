import{r as t,j as e,w as Y,x as W,y as J,z as O,E as K,f as u,G as z,J as B,K as N,B as A,Q as M,U as T,V as P,g as b,W as Q,l as V,P as X,X as Z,m as k,Y as $,Z as ee}from"./vendor-Bc-sSxl_.js";import{u as F,s as m,f as se}from"./index-BfjjasL4.js";function te({event:s,initialSignupStatus:h}){const{profile:p,isAdmin:S}=F(),[D,y]=t.useState(!1),[f,q]=t.useState(0),[U,g]=t.useState([]),[j,w]=t.useState(!!h),[o,i]=t.useState(h),[_,a]=t.useState(!1),[l,x]=t.useState(!1),[c,n]=t.useState(!1),[d,v]=t.useState("");t.useEffect(()=>{w(!!h),i(h)},[h]);const L=async()=>{y(!0),S&&await H()},I=()=>{g([]),y(!1)},H=async()=>{const{count:r,error:C}=await m.from("signups").select("*",{count:"exact",head:!0}).eq("event_id",s.id);C?console.error("Error fetching signups:",C):q(r||0)},G=async()=>{if(!p)return;const r=s.requires_approval?"Waiting List":"Confirmed",{error:C}=await m.from("signups").insert([{user_id:p.id,event_id:s.id,can_drive:_,transport_needed:l,status:r}]);C?(console.error("Error signing up:",C),alert("Failed to sign up.")):(I(),v(s.requires_approval?"Successfully added to waitlist!":"Successfully signed up!"),n(!0),w(!0),i(r))},R=()=>o==="Waiting List"?"On Waitlist":o,E=r=>r==="Confirmed"?{color:"success"}:r==="Cancelled"?{color:"error"}:{color:"default",sx:{backgroundColor:"#757575",color:"white"}};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{sx:{mb:2,position:"relative"},children:[j&&(s.requires_approval?e.jsx(W,{label:R(),...E(o),sx:{...E(o).sx,position:"absolute",top:8,right:8,zIndex:1}}):e.jsx(W,{label:"Signed Up",color:"success",sx:{position:"absolute",top:8,right:8,zIndex:1}})),e.jsxs(J,{onClick:L,children:[e.jsx(O,{component:"img",height:"140",image:s.image_url||"/default-event.jpg",alt:s.name}),e.jsxs(K,{children:[e.jsx(u,{variant:"h5",children:s.name}),e.jsxs(u,{variant:"body2",color:"textSecondary",children:["ðŸ“… ",new Date(s.date).toLocaleDateString()]})]})]})]}),e.jsxs(z,{open:D,onClose:I,PaperProps:{sx:{zIndex:r=>r.zIndex.modal+1}},children:[e.jsx(B,{children:s.name}),e.jsxs(N,{children:[s.image_url&&e.jsx(O,{component:"img",height:"200",image:s.image_url,alt:s.name,sx:{borderRadius:2,marginBottom:2}}),e.jsx(u,{variant:"body1",gutterBottom:!0,children:s.description||"No description available."}),e.jsxs(u,{variant:"body2",color:"textSecondary",children:["ðŸ“… ",new Date(s.date).toLocaleDateString()]}),S&&f>0&&e.jsx("div",{children:e.jsxs(u,{variant:"h6",sx:{mt:2},children:["Signups: ",f]})}),!j&&((p==null?void 0:p.role)==="Driver"?e.jsx(A,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(M,{control:e.jsx(T,{checked:_,onChange:r=>a(r.target.checked)}),label:"I can drive"})}):e.jsx(A,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(M,{control:e.jsx(T,{checked:l,onChange:r=>x(r.target.checked)}),label:"I need Transport"})}))]}),e.jsxs(P,{children:[e.jsx(b,{onClick:I,children:"Close"}),j?s.requires_approval?e.jsx(W,{label:R(),...E(o),sx:{...E(o).sx,mr:2}}):e.jsx(u,{sx:{mr:2,color:"success.main"},children:"You are signed up!"}):e.jsx(b,{variant:"contained",onClick:G,children:s.requires_approval?"Request to Go":"Sign Up"})]})]}),e.jsx(Q,{open:c,autoHideDuration:4e3,onClose:()=>n(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(V,{onClose:()=>n(!1),severity:"success",sx:{width:"100%"},children:d})})]})}function re(){const{isAdmin:s}=F(),[h,p]=t.useState([]),[S,D]=t.useState(new Map),[y,f]=t.useState(!0),[q,U]=t.useState(!1),[g,j]=t.useState({name:"",date:"",location:"",image_url:"",description:"",requires_approval:!1});t.useEffect(()=>{async function a(){f(!0);const{data:{user:l}}=await m.auth.getUser();if(!l){f(!1);return}const[x,c]=await Promise.all([m.from("events").select("*, requires_approval").order("date",{ascending:!0}),m.from("signups").select("event_id, status").eq("user_id",l.id)]);if(x.data){const n=new Date;n.setHours(0,0,0,0);const d=x.data.filter(v=>new Date(v.date)>=n);p(d)}if(c.data){const n=new Map(c.data.map(d=>[d.event_id,d.status]));D(n)}f(!1)}a()},[]);const w=()=>U(!0),o=()=>U(!1),i=a=>{const{name:l,value:x,type:c,checked:n}=a.target;j({...g,[l]:c==="checkbox"?n:x})},_=async()=>{if(!g.name)return alert("Event name is required!");let a=g.image_url;a||(a=await se(g.name));const l={...g,image_url:a||"default-image-url.jpg"},{data:x,error:c}=await m.from("events").insert([l]).select();if(c)console.error("Error creating event:",c);else{const{data:n}=await m.from("events").select("*, requires_approval").order("date",{ascending:!0});if(n){const d=new Date;d.setHours(0,0,0,0);const v=n.filter(L=>new Date(L.date)>=d);p(v)}j({name:"",date:"",location:"",image_url:"",description:"",requires_approval:!1}),o()}};return y?e.jsx(u,{children:"Loading events..."}):e.jsxs(A,{children:[e.jsxs(X,{elevation:4,sx:{p:{xs:2,sm:4},mb:4,borderRadius:2,textAlign:"center",background:"linear-gradient(45deg, #1976d2 30%, #42a5f5 90%)",color:"white"},children:[e.jsx(u,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Upcoming Events"}),e.jsx(u,{variant:"subtitle1",sx:{mb:2},children:"Browse and sign up for our latest sailing adventures."}),s&&e.jsx(b,{variant:"contained",color:"secondary",onClick:w,children:"+ New Event"})]}),e.jsx(Z,{columns:{xs:1,sm:2,md:3,lg:4},spacing:2,children:h.map(a=>e.jsx(te,{event:a,initialSignupStatus:S.get(a.id)||null},a.id))}),e.jsxs(z,{open:q,onClose:o,children:[e.jsx(B,{children:"Create New Event"}),e.jsxs(N,{children:[e.jsx(k,{label:"Event Name",name:"name",fullWidth:!0,onChange:i,sx:{my:1}}),e.jsx(k,{label:"Date",name:"date",type:"date",fullWidth:!0,onChange:i,InputLabelProps:{shrink:!0},sx:{my:1}}),e.jsx(k,{label:"Location",name:"location",fullWidth:!0,onChange:i,sx:{my:1}}),e.jsx(k,{label:"Image URL",name:"image_url",fullWidth:!0,onChange:i,sx:{my:1}}),e.jsx($,{name:"description",minRows:3,placeholder:"Enter event description...",style:{width:"100%",padding:"8px"},onChange:i}),e.jsx(M,{control:e.jsx(ee,{checked:g.requires_approval,onChange:i,name:"requires_approval"}),label:"Waitlist / Requires Approval",sx:{mt:1}})]}),e.jsxs(P,{children:[e.jsx(b,{onClick:o,children:"Cancel"}),e.jsx(b,{onClick:_,variant:"contained",children:"Create"})]})]})]})}export{re as default};
