import{r as s,u as I,j as e,C as W,B as _,i as A,l as S,m as c,F as D,s as Y,t as q,v as y,f as F}from"./vendor-mLxMphKg.js";import{s as n}from"./index-COGqSMdW.js";function M(){const[m,h]=s.useState(""),[u,f]=s.useState(""),[p,l]=s.useState(""),[i,g]=s.useState(""),[x,j]=s.useState(""),[d,o]=s.useState(null),[v,w]=s.useState(""),C=I();s.useEffect(()=>{async function t(){const{data:{user:r}}=await n.auth.getUser();if(r){const{data:a}=await n.from("users").select("*").eq("id",r.id).single();a&&(h(a.name||""),g(a.role||""),f(a.student_number||""),a.student_number||w("Your profile is incomplete. Please add your student number to continue."))}}t()},[]);const E=()=>{if(!/^\d{7}$/.test(u))return l("Student number must be exactly 7 digits."),!1;const t=new Date().getFullYear()%100;return parseInt(u.substring(0,2),10)>t?(l(`The year prefix '${u.substring(0,2)}' cannot be in the future.`),!1):(l(""),!0)},N=async t=>{if(t.preventDefault(),o(null),!E())return;const{data:{user:r}}=await n.auth.getUser();if(!r){o("Error fetching authenticated user.");return}const{error:a}=await n.from("users").upsert({id:r.id,name:m,email:r.email,role:i,student_number:u});if(a){o(a.message);return}if(i==="Driver"){const{error:b}=await n.from("cars").upsert({driver_id:r.id,car_spaces:parseInt(x)},{onConflict:"driver_id"});if(b){o(b.message);return}}await n.auth.updateUser({data:{setup_complete:!0}}),C("/dashboard")};return e.jsx(W,{maxWidth:"false",sx:{width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs(_,{sx:{p:3,boxShadow:3,borderRadius:2,textAlign:"center",maxWidth:400,width:"100%"},children:[e.jsx(A,{variant:"h4",gutterBottom:!0,children:"Account Setup"}),v&&!d&&e.jsx(S,{severity:"info",sx:{my:2},children:v}),d&&e.jsx(S,{severity:"error",sx:{my:2},children:d}),e.jsxs("form",{onSubmit:N,children:[e.jsx(c,{fullWidth:!0,label:"Full Name",required:!0,margin:"normal",value:m,onChange:t=>h(t.target.value)}),e.jsx(c,{fullWidth:!0,label:"Student Number",required:!0,margin:"normal",value:u,onChange:t=>f(t.target.value),error:!!p,helperText:p}),e.jsxs(D,{fullWidth:!0,required:!0,margin:"normal",children:[e.jsx(Y,{children:"Are you a driver?"}),e.jsxs(q,{value:i,onChange:t=>g(t.target.value),children:[e.jsx(y,{value:"Driver",children:"Yes, I can drive"}),e.jsx(y,{value:"Member",children:"No, I'm a passenger"})]})]}),i==="Driver"&&e.jsx(c,{fullWidth:!0,label:"How many seats does your car have (including you)?",type:"number",required:!0,variant:"outlined",margin:"normal",value:x,onChange:t=>j(t.target.value),inputProps:{min:1}}),e.jsx(F,{fullWidth:!0,variant:"contained",type:"submit",sx:{mt:2},children:"Complete Setup"})]})]})})}export{M as default};
