import{Z as w,r as s,u as k,j as e,i,C as _,B as o,w as B,z as I,E as T,N as g,O as p,f as U}from"./vendor-DhX4SPbH.js";import{s as l}from"./index-CdVIviXw.js";function q(){const{eventId:d}=w(),[n,j]=s.useState(null),[u,m]=s.useState(null),[v,y]=s.useState(null),[f,C]=s.useState(!1),[h,E]=s.useState(!1),S=k();s.useEffect(()=>{async function t(){let{data:r,error:a}=await l.from("events").select("*").eq("id",d).single();a?console.error("Error fetching event:",a):j(r)}t()},[d]),s.useEffect(()=>{async function t(){const{data:r,error:a}=await l.auth.getUser();if(a){console.error("Error fetching user:",a);return}if(m(r==null?void 0:r.user),r!=null&&r.user){const{data:c,error:x}=await l.from("users").select("role").eq("id",r.user.id).single();x?console.error("Error fetching user role:",x):y(c==null?void 0:c.role)}}t()},[]);async function b(){if(!u||!n)return;const{error:t}=await l.from("signups").insert([{user_id:u.id,event_id:n.id,session_id:null,can_drive:f,transport_needed:h,status:"Pending"}]);t?(console.error("Error signing up:",t),alert("Failed to sign up. Please try again.")):(alert("Successfully signed up!"),S("/dashboard"))}return n?e.jsx(_,{maxWidth:"xl",sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100vw"},children:e.jsx(o,{display:"flex",justifyContent:"center",children:e.jsxs(B,{sx:{maxWidth:"80%",width:"100%"},children:[e.jsx(I,{component:"img",height:"400",image:n.image_url||"/default-event.jpg",alt:n.name}),e.jsxs(T,{children:[e.jsx(i,{variant:"h4",gutterBottom:!0,align:"center",children:n.name}),e.jsx(i,{variant:"body1",color:"textSecondary",align:"center",children:n.description}),e.jsxs(i,{variant:"body2",sx:{mt:2,textAlign:"center"},children:["ðŸ“… ",n.date]}),v==="Driver"?e.jsx(o,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(g,{control:e.jsx(p,{checked:f,onChange:t=>C(t.target.checked)}),label:"I can drive"})}):e.jsx(o,{display:"flex",justifyContent:"center",mt:2,children:e.jsx(g,{control:e.jsx(p,{checked:h,onChange:t=>E(t.target.checked)}),label:"I need Transport"})}),e.jsx(o,{display:"flex",justifyContent:"center",mt:3,children:e.jsx(U,{variant:"contained",color:"primary",onClick:b,children:"Sign Up"})})]})]})})}):e.jsx(i,{children:"Loading event details..."})}export{q as default};
