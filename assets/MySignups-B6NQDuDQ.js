import{r as i,j as t,g as a,B as p,P as T,W as H,N as L,i as $,s as A,x as P,t as R,a as C}from"./vendor-CM_Zk0Sk.js";import{u as q,s as b}from"./index-9AXypadv.js";function N(){const{profile:l}=q(),[g,x]=i.useState([]),[f,h]=i.useState([]),[w,m]=i.useState(!0),[c,d]=i.useState({open:!1,message:"",severity:"success"});i.useEffect(()=>{if(!l){m(!1);return}async function e(){const{data:n,error:s}=await b.from("signups").select("id, status, events(*, requires_approval)").eq("user_id",l.id);if(s)console.error("Error fetching signups:",s);else{const r=new Date;r.setHours(0,0,0,0);const y=[],S=[];n.forEach(o=>{new Date(o.events.date)>=r?y.push(o):S.push(o)}),x(y.sort((o,u)=>new Date(o.events.date)-new Date(u.events.date))),h(S.sort((o,u)=>new Date(u.events.date)-new Date(o.events.date)))}m(!1)}e()},[l]);async function D(e){const{error:n}=await b.from("signups").delete().eq("id",e);n?d({open:!0,message:"Failed to cancel signup.",severity:"error"}):(d({open:!0,message:"Signup canceled successfully!",severity:"success"}),x(s=>s.filter(r=>r.id!==e)),h(s=>s.filter(r=>r.id!==e)))}const U=e=>{const n=new Date(e);n.setUTCHours(9,0,0,0);const s=n.toISOString().replace(/-|:|\.\d+/g,"");n.setUTCHours(n.getUTCHours()+1);const r=n.toISOString().replace(/-|:|\.\d+/g,"");return`${s}/${r}`},v=(e,n)=>{n!=="clickaway"&&d({...c,open:!1})},k=e=>e==="Waiting List"?"On Waitlist":e,E=e=>e==="Confirmed"?{color:"success"}:e==="Cancelled"?{color:"error"}:{color:"default",sx:{backgroundColor:"#757575",color:"white"}};if(w)return t.jsx(a,{children:"Loading your signed-up events..."});const j=({signup:e,isUpcoming:n})=>{const{events:s}=e;if(!s)return null;const r=`https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(s.name)}&dates=${U(s.date)}&details=${encodeURIComponent(s.description||"")}&location=${encodeURIComponent(s.location||"")}`;return t.jsx(A,{sx:{mb:2},children:t.jsxs(P,{children:[t.jsxs(p,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(a,{variant:"h5",children:s.name}),s.requires_approval&&t.jsx(R,{label:k(e.status),size:"small",...E(e.status)})]}),t.jsxs(a,{variant:"body2",color:"textSecondary",children:["ðŸ“ ",s.location||"No location specified"]}),t.jsxs(a,{variant:"body2",color:"textSecondary",children:["ðŸ“… ",new Date(s.date).toLocaleDateString()]}),n&&t.jsxs(p,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,children:[t.jsx(C,{variant:"contained",color:"secondary",onClick:()=>D(e.id),children:"Cancel Signup"}),t.jsx(C,{variant:"outlined",href:r,target:"_blank",rel:"noopener noreferrer",children:"Add to Calendar"})]})]})})};return t.jsxs(p,{children:[t.jsxs(T,{elevation:4,sx:{p:{xs:2,sm:3},mb:4,borderRadius:2,textAlign:"center",background:"linear-gradient(45deg, #2E7D32 30%, #4CAF50 90%)",color:"white"},children:[t.jsx(a,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"My Signups"}),t.jsx(a,{variant:"subtitle1",children:"Here are all the events you've signed up for, past and present."})]}),t.jsx(a,{variant:"h5",sx:{mt:2,mb:1},children:"Upcoming"}),g.length>0?g.map(e=>t.jsx(j,{signup:e,isUpcoming:!0},e.id)):t.jsx(a,{children:"No upcoming events."}),t.jsx(H,{sx:{my:4}}),t.jsx(a,{variant:"h5",sx:{mt:2,mb:1},children:"Past Events"}),f.length>0?f.map(e=>t.jsx(j,{signup:e,isUpcoming:!1},e.id)):t.jsx(a,{children:"No past events."}),t.jsx(L,{open:c.open,autoHideDuration:6e3,onClose:v,children:t.jsx($,{onClose:v,severity:c.severity,sx:{width:"100%"},children:c.message})})]})}export{N as default};
